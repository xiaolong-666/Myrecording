# 重构-改善既有代码的设计

什么是重构：

> 在不改变代码外在行为的前提下，对代码做出修改，以改进程序的内部结构。本质上说，重构就是在代码写好之后改进它的设计。
>
> 设计不是在一开始就完成的，而是在整个开发过程中逐渐浮现出来。

重构和性能优化有很多相似之处：

> 两者都需要修改代码，并且两者都不会改变程序的整体功能
>
> 差别在于其目的：
>
> 重构是为了让代码 **更容易理解，更容易修改**。这可能使程序运行得更快，也可能使程序运行得更慢。在性能优化时，我只关心让程序运行得更快，最终得到的代码有可能更难理解和维护。

## 为何重构

### 重构改进软件的设计

如果没有重构，程序的内部设计（或者叫架构）会逐渐腐败变质。

**改进设计的一个重要方向就是消除重复代码** ，代码量减少并不会使系统运行更快，因为这对程序的资源占用几乎没有任何明显影响。然后代码量减少将使未来可能的程序修改动作容易得多。

### 重构使软件更容易理解

所谓程序设计，很大程度上就是与计算机对话；除了计算机外，源码还有其他读者。

### 重构帮助找到bug

对代码进行重构，可以深入理解代码的所作所为，并立即把新的理解反映在代码当中。

### 重构提高编程速度

通过投入精力改善内部设计，我们增加了软件的耐久性，从而可以更长时间地保持开发的快速。

## 何时重构

三次法则

> 第一次做某件事时只管去做；第二次做类似的事会产生反感，但无论如何还是可以去做；第三次在做类似的事，你就应该重构。事不过三，三则重构。

### 预备性重构：让添加新功能更容易

重构的最佳时机就在添加新功能之前。

### 帮助理解的重构：使代码更容易懂

比如变量或者函数重命名

### 捡垃圾式重构

发现的垃圾很容易重构，则马上重构它；如果需要花费一定的精力，则等完成当下的任务后再来重构它。             只要让营地比你达到时干净--露营者



**重构的目的是加快开发速度（添加功能更快、修复bug更快）**



## 重构与架构

> 在任何人开始写代码之前，必须先完成软件的设计和架构。（真能这样么？）它假设了软件的需求可以预先充分理解，但经验显示，这个假设大多数时候是不切实际的。



**重构的第一块基石是自测试代码。** 应该有一套自动化的测试，可以频繁的运行它们，并且有信心：在编程过程中犯了任何错误，会有测试失败。

自测试代码、持续集成、重构   彼此间有着很强的协同效应。



## 代码的坏味道

- 神秘命名

- 重复代码

- 过长函数

> 遵循这样一条原则：每当感觉需要以注释来说明点什么的时候，就需要把说明的东西写进一个独立函数中，并以其用途命名。

- 过长参数列表

- 全局数据

- 夸夸其谈通用性

## 重构手法

### 提炼函数

- 将意图与实现分开
- 写非常小的函数，通常只有几行

> 不用担心短函数会造成大量函数调用，因而影响性能。短函数常常能让编译器的优化功能运转更良好，可以更容易的被缓存。所以不用过早担心性能问题。

#### 做法

创造一个新函数，根据这个函数的意图来对它命名（以它 **做什么** 命名，而不是以它 **怎样做** 命名）。

### 提炼变量

表达式有可能非常复杂而难以阅读。可通过局部变量分步奏拆分，这样的变量在调试时也很方便

### 改变函数声明

当你不知道如何取名字时，可以采用这个方式：先写一句注释来描述这个函数的用途，在把这句注释变成函数的名字。

## 省钱链接

在线阅读: https://book-refactoring2.ifmicro.com/docs/ch1.html
